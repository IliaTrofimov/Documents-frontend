<div class="container panel">
    <h4>Редактирование документа</h4>
    <button class="btn btn-outline-secondary dropdown-toggle btn-sm badge" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" [disabled]="!document">Действия</button>
    <div class="dropdown-menu">
        <button *ngIf="document?.Type == 0" class="dropdown-item btn-sm" (click)="save()">Сохранить</button>
        <a class="dropdown-item btn-sm" [routerLink]="['/documents/print/', document?.Id]">Печать</a>
        <button *ngIf="document?.Type == 0" class="dropdown-item btn-sm" (click)="delete()">Удалить</button>
    </div>
    <a class="btn btn-sm" *ngIf="document?.Type == 0" (click)="nextType()">Передать на подписание</a>
    <a class="btn btn-sm" *ngIf="document?.Type == 1" (click)="nextType()">Подписать</a>
    <a class="btn btn-sm" *ngIf="document?.Type == 2" (click)="nextType()">Вывести из оборота</a>
    <hr>
    <button (click)="validate()">validate</button>
    <div class="row" *ngIf="document">
        <div class="col">
            <b>Название</b><br>
            <input class="form-control form-control-sm" [(ngModel)]="document.Name" [readonly]="document.Type != 0" [disabled]="!document"/>
        </div>
        <div class="col">
            <b>Автор</b><br>
            {{document.AuthorName}}
        </div>
        <div class="col">
            <b>Дата истечения</b><br>
            <input type="date" class="form-control form-control-sm" [(ngModel)]="document.ExpireDate" [readonly]="document.Type != 0" [disabled]="!document"/>
        </div>
        <div class="col">
            <div *ngIf="status" class="alert alert-{{status[0] ? 'success' : 'danger'}}" role="alert">
                {{status[1]}}
                <button type="button" class="close" aria-label="Close" (click)="status = undefined" [disabled]="!document">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div> 
        </div>
    </div>
    <hr>
</div>

<loading [status]="!document"></loading>

<div class="container panel" *ngIf="document">
    <h6 class="text-muted">Шаблон: {{document.Template?.Name}}</h6>
    <p *ngFor="let item of document.Template?.TemplateItems">
        <doc-field *ngIf="!item.IsTable" 
            [template]="$any(item)" 
            [data]="$any(getItem(item.Id))"
            [readonly]="document.Type != 0">
        </doc-field>
        <doc-table *ngIf="item.IsTable"
            [table]="$any(item)"
            [columns]="$any(item).TemplateFields" 
            [data]="getColumns(item)"
            [readonly]="document.Type != 0">
        </doc-table>                     
    </p>
    <hr>
    <p class="text-muted">
        Обязательные поля отмечены <span class="badge badge-pill badge-info">*</span>
    </p>  
</div>